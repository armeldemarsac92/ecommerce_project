build-job:
  stage: build
  image: registry.gitlab.com/gitlab-org/cloud-deploy/aws-base:latest
  script:
    - echo 'Connecting to aws services..'
    - aws configure set aws_secret_access_key ${AWS_SECRET_ACCESS_KEY}
    - aws ecr get-login-password --region  ${AWS_REGION} | docker login --username AWS --password-stdin ${AWS_ACCESS_KEY_ID}.dkr.ecr.${AWS_REGION}.amazonaws.com

    - echo "Building the container api.."
    - docker build -t tdev700/prod/api .
    - echo 'Terminate'

# test-job1:
#   stage: test
#   script:
#     - echo "This job tests something"

# test-job2:
#   stage: test
#   script:
#     - echo "This job tests something, but takes more time than test-job1."
#     - echo "After the echo commands complete, it runs the sleep command for 20 seconds"
#     - echo "which simulates a test that runs 20 seconds longer than test-job1"
    # - sleep 20

# deploy-prod:
#   stage: deploy
#   image: registry.gitlab.com/gitlab-org/cloud-deploy/aws-base:latest
#   script:
#     - aws s3 ...
#     - aws create-deployment ...
#   environment: production
