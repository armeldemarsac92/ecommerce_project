image: docker:24.0.7

variables:
  DOCKER_HOST: tcp://docker:2375
  DOCKER_DRIVER: overlay2
  DOCKER_TLS_CERTDIR: ""

build:
  stage: build
  image: docker:24.0.7
  services:
    - docker:24.0.7-dind
  # before_script:
  # - aws ecr get-login-password --region ${AWS_REGION} | docker login --username AWS --password-stdin ${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_REGION}.amazonaws.com
  script:
    - docker info  # Verify docker connectivity
    - docker -v    # Verify docker version
    # - docker build -t ${ECR_REPOSITORY}:${CI_COMMIT_SHA} .
    # - docker tag ${ECR_REPOSITORY}:${CI_COMMIT_SHA} ${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_REGION}.amazonaws.com/${ECR_REPOSITORY}:${CI_COMMIT_SHA}
    # - docker push ${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_REGION}.amazonaws.com/${ECR_REPOSITORY}:${CI_COMMIT_SHA}
    


    # - echo 'Connecting to aws services..'
    # - aws ecr get-login-password --region eu-north-1 | docker login --username AWS --password-stdin 502863813996.dkr.ecr.eu-north-1.amazonaws.com
    # - echo 'building the docker image api..'
    # - docker build -t tdev700/prod/api .
    # - echo 'Tagging the image..'
    # - docker tag tdev700/prod/api:latest 502863813996.dkr.ecr.eu-north-1.amazonaws.com/tdev700/prod/api:latest
    # - echo 'Pushing the image'
    # - docker push 502863813996.dkr.ecr.eu-north-1.amazonaws.com/tdev700/prod/api:latest
    # - echo 'Terminate'

# test-job1:
#   stage: test
#   script:
#     - echo "This job tests something"

# test-job2:
#   stage: test
#   script:
#     - echo "This job tests something, but takes more time than test-job1."
#     - echo "After the echo commands complete, it runs the sleep command for 20 seconds"
#     - echo "which simulates a test that runs 20 seconds longer than test-job1"
    # - sleep 20

# deploy-prod:
#   stage: deploy
#   image: registry.gitlab.com/gitlab-org/cloud-deploy/aws-base:latest
#   script:
#     - aws s3 ...
#     - aws create-deployment ...
#   environment: production
